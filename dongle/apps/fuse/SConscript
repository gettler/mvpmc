#!/usr/bin/python
#
# build fusermount and library files 
#

import os
import mvpmc

Import('env')

build_target = env['TARG']
topdir = env['TOPDIR']
sbindir = '%s/dongle/install/%s/sbin/' % (topdir,build_target)
prefix = '%s/dongle/install/%s' % (topdir,build_target)

e = Environment()

if build_target == 'nmt':
    url = [ 'http://www.mvpmc.org/dl/fuse-2.7.2.tar.gz' ]
    config = '--host=mipsel-linux-uclibc'
else:
    url = [ 'http://www.mvpmc.org/dl/fuse-2.5.3.tar.gz' ]
    config = '--host=powerpc-linux '

target = [ sbindir + 'fusermount' ]
cmd = [ './configure %s -with-gnu-ld --disable-debug  --enable-lib --enable-util --enable-example=no --disable-kernel-module --disable-shared' % config,
        'make',
        'cp util/fusermount %s/sbin/fusermount' % prefix,
        'cp lib/.libs/libfuse.a lib' ]
patches = []

build = mvpmc.OSSBuild(target, url, env, e, cmd, patches)

Return('build')
