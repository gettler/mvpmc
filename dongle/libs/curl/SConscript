#!/usr/bin/python
#
# build curl
#

import os
import mvpmc

Import('env')

build_target = env['TARG']
topdir = env['TOPDIR']
libdir = '%s/dongle/install/%s/lib/' % (topdir,build_target)
incdir = '%s/dongle/install/%s/include/' % (topdir,build_target)
prefix = '%s/dongle/install/%s' % (topdir,build_target)

if build_target == 'mvp':
  cross = env['CROSS']
  config = '--host=powerpc-linux'
  patches = []
  local = ''
  lib = 'libcurl.so'
elif build_target == 'mg35':
  cross = env['CROSS']
  config = '--host=arm-linux --disable-shared'
  patches = []
  lib = 'libcurl.a'
elif (build_target == 'nmt') or (build_target == 'mvphd'):
  cross = env['CROSS']
  config = '--host=mips-linux'
  patches = []
  lib = 'libcurl.so'
else:
  cross = ''
  config = ''
  patches = []
  lib = 'libcurl.so'

url = [ 'http://www.mvpmc.org/dl/curl-7.18.1.tar.bz2' ]

e = Environment()

target = [ libdir + lib,
           incdir + 'curl/curl.h' ]
cmd = [ './configure --prefix=%s %s' % (prefix,config),
        'make',
        'make install' ]

build = mvpmc.OSSBuild(target, url, env, e, cmd, patches)

Return('build')
